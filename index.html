// Update these constants to match your repository
const username = 'alopez5301';
const repo = 'AFREPO';  // Changed from 'AF' to 'AFREPO'
const branch = 'main';

async function initGallery() {
    try {
        // Changed to use the contents API endpoint instead of git/trees
        const response = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/images`);
        const data = await response.json();
        
        const imageFiles = data
            .filter(file => /\.(jpg|jpeg|png|bmp)$/i.test(file.name))
            .map(file => ({
                path: file.path,
                download_url: file.download_url
            }));

        const galleryContainer = document.getElementById('gallery-container');
        galleryContainer.innerHTML = '';

        const resolutionGroups = await loadImagesInBatches(imageFiles);

        const resolutions = Array.from(resolutionGroups.keys())
            .sort((a, b) => {
                const [aWidth, aHeight] = a.split('x').map(Number);
                const [bWidth, bHeight] = b.split('x').map(Number);
                return (bWidth * bHeight) - (aWidth * aHeight);
            });

        createNavigationLinks(resolutions);

        const fragment = document.createDocumentFragment();
        resolutions.forEach(resolution => {
            const section = createSection(resolution);
            const gallery = section.querySelector('.gallery');
            
            resolutionGroups.get(resolution).forEach(image => {
                const item = createGalleryItem(image.path, image.resolution);
                gallery.appendChild(item);
            });
            
            fragment.appendChild(section);
        });

        galleryContainer.appendChild(fragment);

    } catch (error) {
        console.error('Error fetching repository contents:', error);
        document.getElementById('gallery-container').innerHTML = 
            '<div class="loader">Error loading images. Please try refreshing the page.</div>';
    }
}

// Update getRawGitHubUrl function to use the download_url from the API
function getRawGitHubUrl(path) {
    return `https://raw.githubusercontent.com/${username}/${repo}/${branch}/${path}`;
}
