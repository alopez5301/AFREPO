// Repository configuration
const username = 'alopez5301';
const repo = 'AFREPO';
const branch = 'main';

// Main gallery initialization function
async function initGallery() {
    try {
        // Fetch repository contents
        const response = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/images`);
        const data = await response.json();
        
        // Filter and map image files
        const imageFiles = data
            .filter(file => /\.(jpg|jpeg|png|bmp)$/i.test(file.name))
            .map(file => ({
                path: file.path,
                download_url: file.download_url
            }));

        // Clear and prepare gallery container
        const galleryContainer = document.getElementById('gallery-container');
        galleryContainer.innerHTML = '';

        // Process images and group by resolution
        const resolutionGroups = await loadImagesInBatches(imageFiles);

        // Sort resolutions by total pixel count (width * height)
        const resolutions = Array.from(resolutionGroups.keys())
            .sort((a, b) => {
                const [aWidth, aHeight] = a.split('x').map(Number);
                const [bWidth, bHeight] = b.split('x').map(Number);
                return (bWidth * bHeight) - (aWidth * aHeight);
            });

        // Create navigation links for each resolution
        createNavigationLinks(resolutions);

        // Build gallery sections
        const fragment = document.createDocumentFragment();
        resolutions.forEach(resolution => {
            const section = createSection(resolution);
            const gallery = section.querySelector('.gallery');
            
            resolutionGroups.get(resolution).forEach(image => {
                const item = createGalleryItem(image.path, image.resolution);
                gallery.appendChild(item);
            });
            
            fragment.appendChild(section);
        });

        // Add all sections to the container
        galleryContainer.appendChild(fragment);

    } catch (error) {
        console.error('Error fetching repository contents:', error);
        document.getElementById('gallery-container').innerHTML = 
            '<div class="loader">Error loading images. Please try refreshing the page.</div>';
    }
}

// Helper function to get raw GitHub URLs
function getRawGitHubUrl(path) {
    return `https://raw.githubusercontent.com/${username}/${repo}/${branch}/${path}`;
}
